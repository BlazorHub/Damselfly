
@inject UserConfigService configService
@inherits LayoutComponentBase

<MudDialogProvider FullWidth="true" MaxWidth="MaxWidth.Small" />
<RadzenContextMenu />

<ErrorBoundary>
    <ChildContent>
        <CascadingAuthenticationState>
            <LoginForcer />
            <ThemeSwitcher />
            <div class="damselfly-container">
                <div class="damselfly-application">
                    <RadzenSplitter Collapse=@OnCollapse Expand="@OnExpand" Resize=@OnResize style="border: 3px solid rgba(0,0,0,.08);">
                        <RadzenSplitterPane Size="@SideBarSize" Collapsed="@Collapsed" Min="150px" Max="70%">
                            <SideBar />
                        </RadzenSplitterPane>
                        <RadzenSplitterPane Collapsible="false">
                            @Body
                        </RadzenSplitterPane>
                    </RadzenSplitter>
                </div>
                <Statusbar />
            </div>
        </CascadingAuthenticationState>
    </ChildContent>
    <ErrorContent>
        <p>An error occurred. Please check the Damselfly logs and reload the page.</p>
    </ErrorContent>
</ErrorBoundary>
@code{
    private string SideBarSize { get; set; }
    private bool Collapsed { get; set; }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        SideBarSize = configService.Get("SideBarWidth", "20%");
        Collapsed = configService.GetBool("SideBarCollapsed", false);
    }

    void OnResize(RadzenSplitterResizeEventArgs args)
    {
        if( args.PaneIndex == 0 )
        {
            var newSize = $"{(int)args.NewSize}%";
            configService.Set("SideBarWidth", newSize);
            configService.Set("SideBarCollapsed", "false");
        }
    }

    void OnCollapse(RadzenSplitterEventArgs args)
    {
        if (args.PaneIndex == 0)
        {
            Collapsed = true;
            configService.Set("SideBarCollapsed", Collapsed.ToString());
        }
    }

    void OnExpand(RadzenSplitterEventArgs args)
    {
        if (args.PaneIndex == 0)
        {
            Collapsed = false;
            configService.Set("SideBarCollapsed", Collapsed.ToString());
        }
    }
}


